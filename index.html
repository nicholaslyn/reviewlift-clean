<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>ReviewLift — Reviews on Autopilot</title>
<meta name="theme-color" content="#5b63ff"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{ --ink:#0f172a; --muted:#64748b; --bg:#f6f7ff; --panel:#fff; --brand:#5b63ff; --ring:#e5e7eb;
         --radius:16px; --shadow:0 12px 30px rgba(2,8,23,.12); }
  @media (prefers-color-scheme: dark){
    :root{ --ink:#e5e7eb; --muted:#9aa6b2; --bg:#0b1220; --panel:#0f172a; --brand:#7c72ff; --ring:#1f2937; }
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:15px/1.6 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  a{color:inherit;text-decoration:none}
  header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.85);backdrop-filter:saturate(1.1) blur(8px);border-bottom:1px solid rgba(2,8,23,.06)}
  .wrap{max-width:1180px;margin:auto;padding:16px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .stack{display:flex;flex-direction:column;gap:14px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800}
  .badge{font-size:12px;background:#eef2ff;color:#1e1b4b;padding:2px 8px;border-radius:999px}
  .ok{background:#0ea5e9;color:#fff} .ok.green{background:#10b981}
  nav{display:flex;gap:8px;flex-wrap:wrap}
  .tab{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(2,8,23,.1);background:#fff;border-radius:999px;padding:9px 14px;cursor:pointer;font-weight:600}
  .tab.active{background:var(--brand);color:#fff;border-color:transparent;box-shadow:0 10px 22px rgba(91,99,255,.28)}
  main{display:grid;grid-template-columns:1.15fr .85fr;gap:18px}
  .card{background:var(--panel);border:1px solid rgba(2,8,23,.08);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
  h2{margin:0 0 10px 0;font-size:17px}
  .hint{color:var(--muted);font-size:12px}
  input,select,textarea,button{border-radius:12px;border:1px solid rgba(2,8,23,.12);background:#fff;color:var(--ink);padding:10px 12px;font:inherit}
  button{cursor:pointer} textarea{min-height:96px}
  button.primary{background:var(--brand);color:#fff;border-color:transparent;box-shadow:0 10px 22px rgba(91,99,255,.28);font-weight:700}
  .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .kpi{border:1px solid rgba(2,8,23,.08);border-radius:14px;padding:14px;background:#fff}
  .num{font-weight:800;font-size:24px}
  .cols2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .qr{display:grid;place-items:center;background:#fff;border:1px dashed rgba(2,8,23,.18);border-radius:12px;min-height:260px}
  .previewCard{border:1px solid var(--ring);border-radius:14px;padding:16px;background:#fff;box-shadow:0 10px 24px rgba(2,8,23,.08)}
  .logoPreview{width:48px;height:48px;border-radius:12px;object-fit:cover;border:1px solid var(--ring)}
  .diag{position:fixed;left:16px;bottom:16px;background:#111827;color:#fff;padding:8px 10px;border-radius:10px;font-size:12px;box-shadow:0 10px 24px rgba(2,8,23,.4);z-index:99;max-width:72vw;white-space:pre-wrap}
  @media (max-width:1040px){ main{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <div class="wrap row" style="justify-content:space-between">
    <div class="brand">
      <div style="width:12px;height:12px;border-radius:999px;background:var(--brand)"></div>
      ReviewLift
      <span class="badge">v31-LTS</span>
      <span id="jsok" class="badge ok">JS: loading…</span>
    </div>
    <nav>
      <button class="tab active" id="tab-setup" onclick="showTab('setup')">Setup</button>
      <button class="tab" id="tab-requests" onclick="showTab('requests')">Requests</button>
      <button class="tab" id="tab-replies" onclick="showTab('replies')">Reply Composer</button>
      <button class="tab" id="tab-dashboard" onclick="showTab('dashboard')">Dashboard</button>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- LEFT -->
  <section class="card stack" id="pane-setup">
    <h2>Business Setup</h2>

    <!-- TEST BUTTONS (prove clicks work) -->
    <div class="row" style="gap:8px">
      <button onclick="testAlert()">Test Alert</button>
      <button onclick="testToast()">Test Toast</button>
      <button onclick="testCopy()">Test Copy</button>
      <span class="hint">These three must work. If they do, your buttons are fine.</span>
    </div>

    <div class="row">
      <label class="grow">Business name<br><input id="bizName" class="grow" placeholder="Acme Barbers" oninput="previewUpdate()"></label>
      <label>Logo<br><input id="logoFile" type="file" accept="image/*" onchange="onLogoChange(this)"></label>
      <img id="logoPreview" class="logoPreview" alt="" style="display:none">
    </div>
    <div class="row"><label class="grow">Google Maps / Reviews link<br><input id="mapsLink" class="grow" placeholder="Paste your Google listing link"></label></div>
    <div class="stack">
      <div class="row">
        <label>Brand color<br><input id="brand" type="color" value="#5b63ff" oninput="setBrand(this.value)"></label>
        <div class="row">
          <button onclick="setBrand('#5b63ff')" style="width:28px;height:28px;border-radius:999px;border:2px solid #fff;background:#5b63ff"></button>
          <button onclick="setBrand('#0ea5e9')" style="width:28px;height:28px;border-radius:999px;border:2px solid #fff;background:#0ea5e9"></button>
          <button onclick="setBrand('#10b981')" style="width:28px;height:28px;border-radius:999px;border:2px solid #fff;background:#10b981"></button>
          <button onclick="setBrand('#ef4444')" style="width:28px;height:28px;border-radius:999px;border:2px solid #fff;background:#ef4444"></button>
          <button onclick="setBrand('#f59e0b')" style="width:28px;height:28px;border-radius:999px;border:2px solid #fff;background:#f59e0b"></button>
          <button onclick="setBrand('#111827')" style="width:28px;height:28px;border-radius:999px;border:2px solid #fff;background:#111827"></button>
        </div>
      </div>
      <label>Default ask message<br>
        <textarea id="msg" placeholder="Hey {firstName}! It was great seeing you today. If we earned your 5★, would you mind leaving a quick review? {link}"></textarea>
      </label>
      <div class="row">
        <button class="primary" onclick="saveSetup()">Save</button>
        <button onclick="copyLink()">Copy Customer Link</button>
        <button onclick="showQR()">Show QR</button>
        <button onclick="openPreview()">Open public page</button>
        <span class="hint">Link/QR opens your branded review page.</span>
      </div>
      <div class="qr" id="qrBox" style="display:none"><img id="qrImg" alt="QR will appear here"/></div>
      <div class="cols2">
        <div class="card">
          <div class="hint" style="font-weight:700">Backup</div>
          <div class="row" style="margin-top:10px">
            <button onclick="exportData()">Export JSON</button>
            <button onclick="importData()">Import JSON</button>
          </div>
        </div>
        <div class="card">
          <div class="hint" style="font-weight:700">Install</div>
          <div class="stack" style="margin-top:10px">
            <div class="hint">iPhone (Safari): Share → Add to Home Screen</div>
            <div class="hint">Android (Chrome): Menu ⋮ → Add to Home screen</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="card stack" id="pane-requests" style="display:none">
    <h2>Smart Ask</h2>
    <div class="row">
      <label>Customer first name<br><input id="firstName" placeholder="Sam" oninput="refreshAsk()"></label>
      <label>Visit type<br><input id="visit" placeholder="fade / oil change / cleaning" oninput="refreshAsk()"></label>
    </div>
    <div class="row"><textarea id="msgOut" class="grow" placeholder="Message will appear here..."></textarea></div>
    <div class="row">
      <button class="primary" onclick="copySMS()">Copy SMS</button>
      <button onclick="copyWhatsApp()">Copy WhatsApp</button>
      <button onclick="copyEmail()">Copy Email</button>
      <button onclick="copyLinkOnly()">Copy review link only</button>
      <span class="hint">Paste into your messaging app. Each copy logs a request.</span>
    </div>
  </section>

  <section class="card stack" id="pane-replies" style="display:none">
    <h2>Reply Composer</h2>
    <div class="row">
      <label>Customer name<br><input id="rName" placeholder="Sam"></label>
      <label>Stars<br><select id="rStars"><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select></label>
    </div>
    <div class="row"><textarea id="rText" class="grow" placeholder="Paste their review here (optional)"></textarea></div>
    <div class="row"><button class="primary" onclick="genReply()">Generate</button></div>
    <div id="replyList" class="stack"></div>
  </section>

  <section class="card stack" id="pane-dashboard" style="display:none">
    <h2>Dashboard</h2>
    <div class="kpis">
      <div class="kpi"><div class="num" id="kSent">0</div><div class="hint">Requests sent</div></div>
      <div class="kpi"><div class="num" id="kMarked">0</div><div class="hint">Reviews marked</div></div>
      <div class="kpi"><div class="num" id="kConv">0%</div><div class="hint">Conversion (manual)</div></div>
    </div>
    <div class="row">
      <button class="primary" onclick="markReview()">+ Mark a new review</button>
      <button onclick="exportCSV()">Export CSV</button>
      <button onclick="resetData()">Reset</button>
    </div>
    <div class="hint">V1 tracks sends and reviews locally on this device.</div>
  </section>

  <!-- RIGHT: live preview -->
  <aside class="card stack">
    <h2>Public page preview</h2>
    <div class="previewCard">
      <div class="row" style="gap:10px">
        <img id="pvLogo" style="width:40px;height:40px;border-radius:10px;border:1px solid var(--ring);display:none" alt="">
        <div id="pvName" style="font-weight:800">Your Business</div>
      </div>
      <div style="margin:10px 0;color:#475569">It only takes 30 seconds. Your feedback helps local customers find us. Thank you!</div>
      <a id="pvBtn" style="display:inline-block;padding:12px 14px;border-radius:12px;color:#fff;background:var(--brand);font-weight:800">Write a Google Review</a>
      <div class="hint" style="margin-top:8px">Logo/name/color update live as you edit.</div>
    </div>
  </aside>
</main>

<!-- Toasts + Diagnostics -->
<div class="wrap" id="toastBox" style="position:fixed;inset:auto 16px 16px auto;display:flex;flex-direction:column;gap:8px;z-index:50"></div>
<div id="diag" class="diag">Booting…</div>

<script>
/* ===== Minimal, plain ES5 ===== */
function $(id){ return document.getElementById(id); }
var diag = $('diag'); function log(s){ diag.style.display='block'; diag.textContent = (diag.textContent? diag.textContent+'\\n' : '') + s; }
function ok(b){ var el=$('jsok'); el.textContent = b?'JS: OK':'JS: FAIL'; el.className = 'badge ok'+(b?' green':''); }

var K = { data:'rl_data_v1', log:'rl_log_v1' };
var S = JSON.parse(localStorage.getItem(K.data) || '{}');
var LOGS = JSON.parse(localStorage.getItem(K.log) || '[]');
function save(){ localStorage.setItem(K.data, JSON.stringify(S)); localStorage.setItem(K.log, JSON.stringify(LOGS)); }
function toast(msg){ var t=document.createElement('div'); t.textContent=msg; t.style.cssText='background:#0f172a;color:#fff;padding:10px 12px;border-radius:12px;box-shadow:0 10px 24px rgba(2,8,23,.25)'; $('toastBox').appendChild(t); setTimeout(function(){ t.style.opacity='0'; setTimeout(function(){ if(t.parentNode) t.parentNode.removeChild(t); },260); },1900); }
function copyTextGuaranteed(txt){ try{ var ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); toast('Copied'); }catch(e){ prompt('Copy this:', txt); }}

/* Test buttons */
function testAlert(){ alert('✅ Buttons are firing.'); }
function testToast(){ toast('✅ Toast works.'); }
function testCopy(){ copyTextGuaranteed('This is a copy test.'); }

/* Tabs */
function showTab(name){
  var ids=['setup','requests','replies','dashboard'];
  for(var i=0;i<ids.length;i++){
    var n=ids[i]; $('pane-'+n)?.style && ($('pane-'+n).style.display = (n===name)?'block':'none');
    var tab=$('tab-'+n); if(tab){ tab.className = 'tab' + (n===name?' active':''); }
  }
  window.scrollTo(0,0);
  log('Tab: '+name);
}

/* Branding / preview */
function setBrand(c){ S.brand=c; save(); document.documentElement.style.setProperty('--brand', c||'#5b63ff'); $('pvBtn').style.background=c||'#5b63ff'; toast('Color set'); }
function onLogoChange(input){ var f=input.files && input.files[0]; if(!f) return; var r=new FileReader(); r.onload=function(){ S.logo=r.result; save(); $('logoPreview').src=S.logo; $('logoPreview').style.display='block'; $('pvLogo').src=S.logo; $('pvLogo').style.display='block'; toast('Logo saved'); }; r.readAsDataURL(f); }
function previewUpdate(){ $('pvName').textContent = $('bizName').value.replace(/^\\s+|\\s+$/g,'') || 'Your Business'; if(S.logo){ $('pvLogo').src=S.logo; $('pvLogo').style.display='block'; } document.documentElement.style.setProperty('--brand', ($('brand').value||S.brand||'#5b63ff')); $('pvBtn').style.background = ($('brand').value||S.brand||'#5b63ff'); }

/* Data + links */
function defaultMsg(){ return 'Hey {firstName}! It was great seeing you today. If we earned your 5★, would you mind leaving a quick review? {link}'; }
function payload(){ return { n:S.bizName||'Your Business', c:S.brand||'#5b63ff', l:S.mapsLink||'https://maps.google.com', msg:S.msg||defaultMsg(), logo:S.logo||'' }; }
function b64(o){ return window.btoa(unescape(encodeURIComponent(JSON.stringify(o)))); }
function publicLink(){ return location.origin+location.pathname+'#p/'+b64(payload()); } /* anchor for easy copy */

function saveSetup(){
  S.bizName=$('bizName').value.replace(/^\\s+|\\s+$/g,'')||'Your Business';
  S.mapsLink=$('mapsLink').value.replace/^\\s+|\\s+$/g,'')||'https://maps.google.com';
  S.brand=$('brand').value||'#5b63ff';
  S.msg=$('msg').value.replace(/^\\s+|\\s+$/g,'')||defaultMsg();
  save(); previewUpdate(); toast('Saved.');
}
function copyLink(){ copyTextGuaranteed(publicLink()); }
function copyLinkOnly(){ copyTextGuaranteed(publicLink()); }
function showQR(){ $('qrBox').style.display='grid'; $('qrImg').src='https://api.qrserver.com/v1/create-qr-code/?size=300x300&data='+encodeURIComponent(publicLink()); }

/* Requests */
function refreshAsk(){
  var out=(S.msg||defaultMsg())
    .replace('{firstName}', ($('firstName').value||'').replace(/^\\s+|\\s+$/g,'') || 'there')
    .replace('{visit}', ($('visit').value||'').replace(/^\\s+|\\s+$/g,'') || 'visit')
    .replace('{link}', publicLink());
  $('msgOut').value=out;
}
function copySMS(){ refreshAsk(); copyTextGuaranteed($('msgOut').value); LOGS.push({type:'send',channel:'sms',at:new Date().toISOString(),link:publicLink()}); save(); }
function copyWhatsApp(){ refreshAsk(); copyTextGuaranteed($('msgOut').value); LOGS.push({type:'send',channel:'whatsapp',at:new Date().toISOString(),link:publicLink()}); save(); }
function copyEmail(){ refreshAsk(); copyTextGuaranteed($('msgOut').value); LOGS.push({type:'send',channel:'email',at:new Date().toISOString(),link:publicLink()}); save(); }

/* Replies */
function genReply(){
  var name=($('rName').value||'').replace(/^\\s+|\\s+$/g,'');
  var stars=+$('rStars').value;
  var tone={
    5:['Thanks'+(name?', '+name:'')+'! We’re pumped you loved your visit.',
       'You made our day'+(name?', '+name:'')+'! Thanks for the 5★—we’ll be ready next time.',
       'Huge thanks'+(name?', '+name:'')+'! Reviews like this keep our small business going.'],
    4:['Thanks so much'+(name?', '+name:'')+'! Anything we could do to earn that last star?',
       'Really appreciate it'+(name?', '+name:'')+'. We’re aiming for 5★ next time—thanks!',
       'Thanks for the review! We’re glad you had a good experience and we’re pushing for great.'],
    3:['Thanks for the honest feedback'+(name?', '+name:'')+'. Mind DM’ing us details?',
       'We hear you. Please reply so we can make it right.',
       'Appreciate the notes. We’re working on this and value your detail.'],
    2:['We’re sorry this missed the mark'+(name?', '+name:'')+'. Please contact us so we can fix it—this isn’t our standard.',
       'Thanks for telling us. We’re addressing this now—could we connect and make it right?',
       'We dropped the ball here. If you’ll give us another chance, we’d like to make it up to you.'],
    1:['We’re really sorry, '+(name||'friend')+'. This isn’t acceptable and we want to fix it—please reach us so we can make it right.',
       'We hear your frustration and take it seriously. Can we connect to make this right?',
       'Thank you for flagging this. We’re reviewing with our team immediately—please DM so we can resolve it.']
  };
  var list=tone[stars]||tone[5], host=$('replyList'); host.innerHTML='';
  for(var i=0;i<list.length;i++){
    var card=document.createElement('div'); card.className='card'; card.style.padding='10px'; card.appendChild(document.createTextNode(list[i]));
    var row=document.createElement('div'); row.className='row'; row.style.marginTop='6px';
    var b=document.createElement('button'); b.textContent='Copy'; b.onclick=(function(txt){ return function(){ copyTextGuaranteed(txt); }; })(list[i]);
    row.appendChild(b); card.appendChild(row); host.appendChild(card);
  }
}

/* Dashboard */
function renderKpis(){
  var sent=0, marked=0; for(var i=0;i<LOGS.length;i++){ if(LOGS[i].type==='send') sent++; if(LOGS[i].type==='review') marked++; }
  $('kSent').textContent=sent; $('kMarked').textContent=marked; $('kConv').textContent = sent? Math.round(marked/sent*100)+'%' : '0%';
}
function markReview(){ LOGS.push({type:'review',at:new Date().toISOString()}); save(); renderKpis(); toast('Marked'); }
function exportCSV(){
  var rows=[['type','channel','at','link']], i, x;
  for(i=0;i<LOGS.length;i++){ x=LOGS[i]; rows.push([x.type,x.channel||'',x.at||'',x.link||'']); }
  var csv='', r, c, v; for(r=0;r<rows.length;r++){ var line=''; for(c=0;c<rows[r].length;c++){ v=String(rows[r][c]||'').replace(/"/g,'""'); line+=(c? ',':'')+'"'+v+'"'; } csv+=line+'\\n'; }
  var a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='reviewlift-log.csv'; a.click();
}
function resetData(){ if(confirm('Clear local data?')){ localStorage.removeItem(K.data); localStorage.removeItem(K.log); location.reload(); } }
function exportData(){ var a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify({S:S,LOGS:LOGS},null,2)],{type:'application/json'})); a.download='reviewlift-backup.json'; a.click(); }
function importData(){ var inp=document.createElement('input'); inp.type='file'; inp.accept='application/json'; inp.onchange=function(){ var f=inp.files[0]; if(!f) return; var r=new FileReader(); r.onload=function(){ try{ var o=JSON.parse(r.result); if(o.S){ for(var k in o.S){ S[k]=o.S[k]; } } if(o.LOGS && o.LOGS.splice){ LOGS.splice(0,LOGS.length); for(var i=0;i<o.LOGS.length;i++){ LOGS.push(o.LOGS[i]); } } save(); location.reload(); }catch(e){ alert('Import failed: '+e.message); } }; r.readAsText(f); }; inp.click(); }

/* INIT */
(function(){
  try{
    $('jsok').textContent='JS: OK'; $('jsok').className='badge ok green';
    $('bizName').value=S.bizName||''; $('mapsLink').value=S.mapsLink||''; $('brand').value=S.brand||'#5b63ff'; $('msg').value=S.msg||defaultMsg();
    if(S.logo){ $('logoPreview').src=S.logo; $('logoPreview').style.display='block'; $('pvLogo').src=S.logo; $('pvLogo').style.display='block'; }
    document.documentElement.style.setProperty('--brand', S.brand||'#5b63ff'); $('pvBtn').style.background = S.brand||'#5b63ff';
    previewUpdate(); renderKpis(); showTab('setup');
    log('Admin ready (v31-LTS).');
  }catch(e){ ok(false); log('Init error: '+e.message); }
})();
window.onerror=function(msg,src,line,col){ log('Error: '+msg+(src?(' @ '+src+':'+line+':'+col):'')); };
</script>
</body>
</html>

